---
title: "NYPD shouting Incident: DSTA5301 wk3 project"
author: "-"
date: "3/28/2022"
output:
  pdf_document: default
  html_document: default
--geom## Introduction
This document is the project for the week 3 of DSTA5301: Data Science as a field. 

The goal of this project is to analyze a dataset from the NYPD. The expected output of this work are:

* Download the dataset and clean it
* Include at least 2 visualizations
* Include at least one model
* Identify bias

This analyze will focus on incidents over time.

```{r getting_librairies, include=FALSE}
library(tidyverse)
library(lubridate)
library(scales)
```
## Importing data
The data are imported from: [link](https://catalog.data.gov/dataset). As the source of our data is governmental, we can consider it as reliable. 

First, let's import our data and look at the first rows to understand the structure of our dataset:  

```{r get_data}
s_data <- read.csv("https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv?accessType=DOWNLOAD")
#head(data, 5)

```
There is a lot of information in this dataset. Hopefully we don't need all the information and in the next chapter we will clean our data.



## Data cleaning and preparation
First, we want to get rid of the unnecessary columns. Here are the columns from the dataset: 

```{r data_print_colnames}
colnames(s_data)
```
For this analysis, we'll focus on time and borough. We can get rid of everything else. 

```{r}
s_data <- s_data %>%
  select(c(OCCUR_DATE, OCCUR_TIME, BORO)) %>%
  mutate(date = mdy(OCCUR_DATE)) %>%
  mutate(time = hms(OCCUR_TIME)) %>%
  mutate(n = 1) %>% 
  select(-c(OCCUR_DATE, OCCUR_TIME))
summary(s_data)
```
There are no missing values in the data.

## Visualizations and Analysis
### Where to shooting incident happened ? 
In this section, we'll focus on where do shooting incident happened. The first graphic will show the total count of shooting incident in each Borough

```{r plot_bar_borogh}
ggplot(data=s_data, aes(x = BORO, fill=BORO)) +
  geom_bar() +
  labs(title = "Total shooting incident by BORO")

```
Brooklyn is the borough where the most shooting incident happened. Brooklyn is the New York city most populous borough ([source](https://en.wikipedia.org/wiki/Brooklyn)) and is very busy. To better compare borough I suggest taking into account population of borough's as well as mobility data (Google mobility data for example). In the context of this work, we won't go further in the analysis.

### How have the shooting incident evolved over the last 15 years ? 

```{r}
ggplot(data = s_data, mapping = aes(x = date)) +
  geom_freqpoly(mapping = aes(colour = BORO), binwidth = 30)+
  labs(title = "Evolution of shooting incidents")

```

The results show some interesting points: 

* We can clearly see a correlation between season and borough; 
* The more incident they are, the more visible the season correlation is visible;
* There is no season correlation for Staten Island. This could mean that shooting incidents in Staten Island differs from the other borough;
* There is a big peak just after 2020;

There is a downward trend that we will analyze later. 


### How do the season change the shooting incident
```{r}
s_data$month <- as.factor(format (s_data$date, format = "%m"))
ggplot(data = s_data, mapping = aes(month, fill=BORO)) +
  geom_bar()+
  labs(title = "Evolution of shooting incidents in season")

```
The x scale of this graphic corresponds to the month number and the y-axis to the count of shooting incident. As suspected previously, there is a correlation between season and shooting incident. From the graphic, we can understand that winter is quieter than summer, and the period when the more shooting incident are happening is July-August. This Graphic also confirm an observation we did earlier: there is no season correlation for Stan Island. 

This seasonal correlation make sens in the NY's climate. The cold NY's cold winters may explain these winter decrease of shooting incident. 

### Daytime evolution
```{r}
s_data_hour <- s_data %>%
  group_by(hour(time)) %>%
  count()
  

ggplot(data = s_data_hour, aes(x=`hour(time)`, y=n)) +
  geom_point() + 
  labs(title = "Evolution of shooting incidents in a day")

```
The count of shooting incidents per hour show that the incidents decrease from midnight to reach a minimum between 7 AM and 9 AM. Then the count progressively increase with the day. An interesting point here is to see that the incidents count increase almost linearly up to 8 PM and then there is a bigger increase. 

### Evolution of the shooting indicents
To analyze the trend of the shooting incidents, we create a `year_tot` table which summarize the number of incidents per year :
```{r}
years_tot = s_data %>%
  group_by(year(date))%>%
  count()
```
Then we do a linear regression of the number of incidents over the years:
```{r}
mod <- lm(n ~ `year(date)`, data = years_tot)
years_tot$pred <- predict(mod)
```
And then we can plot the total number of incidents per year (red) and the predictions (blue)
```{r}
ggplot(data = years_tot) +
  geom_point(aes(x = `year(date)`, y = n), color="red") +
  geom_line(aes(x = `year(date)`, y=pred), color="blue") +
  labs(title = "Total shooting incident per year \n") 

```
We can clearly see the downward trend on the graphic. There is a "periodic" variation along time. A FFT may give some useful information to push the analysis forward. 




## Conclusion
The analysis of shooting incidents in NY reported by the police department shown that there are different time dependent behavior. The first frequency is annual, we can see in the data that the shooting incidents happened more in summer than in winter. In a day scale, we can observe that the number of incidents begins in the morning and increase linearly up to midnight. From midnight, the count of incidents begin to decrease to the morning. Then long term variation (15 years) show that shooting incidents seems to decrease among years. 

This analysis don't take into account the evolution of the number of NY's citizen or their mobility. From Wikipedia, we can see that the population of NY increases by 7.7% from 2010 to 2020. Despite this population increase, the number of annual count of shooting incident go in the good direction ! Another interesting point is the count of incidents for the year 2020, which is far from the decreasing prediction. 

I never went to NY and I don't know the city more than what I saw in movies. This is the reason why I choose to work more on the frequency and evolution of the incidents.  It could be interesting to perform this analysis with different people of NY and discuss the results after. 

```{r}
total_number_of_incidents = length(s_data$n)
number_of_days = length(seq(from = min(s_data$date), to = max(s_data$date), by = 'day')) -1

```


```{r session, echo=TRUE}
sessionInfo()
```


